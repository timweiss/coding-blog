<!DOCTYPE html><html><head><title>Tim's Coding Blog | Building a fully working contact list in SwiftUI</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/blog/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/blog/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/blog/bundle/codedoc-bundle.js"></script><script>window.githubConfig={"repo":"coding-blog","user":"timweiss"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Tim's Coding Blog | Building a fully working contact list in SwiftUI"><meta name="twitter:image" content="https://tims.coding.blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/contactlist-large-light.png"><meta property="og:type" content="article"><meta property="og:title" content="Tim's Coding Blog | Building a fully working contact list in SwiftUI"><meta property="og:image" content="https://tims.coding.blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/contactlist-large-light.png"></head><body><div class="header-0-0-5"><a class="watermark-0-0-4" href="https://coding.blog" target="_blank"><svg viewBox="0 0 701 443" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="coding.blog" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-162.000000, -246.000000)" id="Shape"><path d="M538.081948,246.348452 L538.52402,246.445719 L538.52402,246.445719 L538.85529,246.526578 L538.85529,246.526578 L600.956012,263.165455 C602.767076,263.660918 604.526214,264.465865 606.146589,265.591976 C611.80881,269.527048 614.090389,276.211909 612.345003,282.123825 L538.2641,559.728905 C537.816127,561.562539 536.989561,563.335054 535.765607,564.944016 C530.70443,571.597248 520.764856,572.934442 513.564947,567.930724 C507.902727,563.995652 505.621148,557.310791 507.366534,551.398875 L577.145082,289.91439 L546.233523,281.631663 L462.305576,595.917544 L468.439004,634.645619 L493.907962,603.194573 C499.468987,596.327279 509.54413,595.268339 516.411424,600.829364 C523.278717,606.390389 524.337658,616.465532 518.776633,623.332826 L470.948283,682.395919 C466.887248,687.410879 460.418878,689.3283 454.55045,687.832105 L454.212574,687.741996 C448.224449,686.200133 443.421088,681.240355 442.392221,674.744345 L430.503202,599.680031 C430.418831,599.147339 430.361793,598.616628 430.331048,598.089327 C429.783912,595.705405 429.838457,593.220092 430.535776,590.858154 L519.361965,258.223717 L519.447729,257.889555 L519.447729,257.889555 L519.532157,257.586199 L519.627058,257.23399 C520.074771,255.398716 520.901697,253.624577 522.126677,252.014264 C525.828762,247.147643 532.141006,245.125338 538.081948,246.348452 Z M632.156421,656.157784 C640.992977,656.157784 648.156421,663.321228 648.156421,672.157784 C648.156421,680.99434 640.992977,688.157784 632.156421,688.157784 L528.156421,688.157784 C519.319865,688.157784 512.156421,680.99434 512.156421,672.157784 C512.156421,663.321228 519.319865,656.157784 528.156421,656.157784 L632.156421,656.157784 Z M699.234631,342.452157 L857.62655,500.844076 C863.874939,507.092464 863.874939,517.223104 857.62655,523.471493 L699.234631,681.863412 C692.986243,688.1118 682.855603,688.1118 676.607214,681.863412 C670.358826,675.615023 670.358826,665.484383 676.607214,659.235995 L823.686132,512.157077 L676.607214,365.079574 C670.358826,358.831185 670.358826,348.700545 676.607214,342.452157 C682.855603,336.203768 692.986243,336.203768 699.234631,342.452157 Z M347.705627,342.452157 C353.954016,348.700545 353.954016,358.831185 347.705627,365.079574 L200.62671,512.158491 L347.705627,659.235995 C353.954016,665.484383 353.954016,675.615023 347.705627,681.863412 C341.457239,688.1118 331.326599,688.1118 325.07821,681.863412 L166.686292,523.471493 C160.437903,517.223104 160.437903,507.092464 166.686292,500.844076 L325.07821,342.452157 C331.326599,336.203768 341.457239,336.203768 347.705627,342.452157 Z"></path></g></g></svg></a></div><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"swift-stuff/building-a-fully-working-contact-list-in-swiftui.md","namespace":"/blog","title":{"base":"Tim's Coding Blog","connector":" | "}}</script><div class="hero-0-0-14" data-mode="light" data-target="desktop" style="margin-bottom: -156px"><img src="https://tims.coding.blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/contactlist-large-light.png" class="image-0-0-15" data-hero=""><span class="caption-0-0-16"></span></div><div class="hero-0-0-14" data-mode="light" data-target="mobile" style="margin-bottom: -96px"><img src="https://tims.coding.blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/contactlist-small-light.png" class="image-0-0-15" data-hero=""><span class="caption-0-0-16"></span></div><div class="hero-0-0-14" data-mode="dark" data-target="desktop" style="margin-bottom: -156px"><img src="https://tims.coding.blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/contactlist-large-dark.png" class="image-0-0-15" data-hero=""><span class="caption-0-0-16"></span></div><div class="hero-0-0-14" data-mode="dark" data-target="mobile" style="margin-bottom: -96px"><img src="https://tims.coding.blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/contactlist-small-dark.png" class="image-0-0-15" data-hero=""><span class="caption-0-0-16"></span></div><h1 class="h-0-0-11 white"><span style=" 
      text-shadow: 0 0 8px black; 
      font-size: 48px"><p>Building a fully working contact list in SwiftUI</p></span></h1><script id="tJHgKxebdg">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("tJHgKxebdg", "DmEvOYtw7XYnMs6x+25YJA==", {"src":"github"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><marker><br>

</marker><h2 id="1-why-this-exists" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>1. Why this exists</h2><p>In a recent project, I needed to build a contact list which displays all system contacts. While this wasn’t too hard to achieve, I had to incorporate a lot of stuff I have only learned about then, as I’m still relatively new to building iOS apps. The existing guides were either still for mainly UIKit based apps or only covered the basics.</p><h2 id="2-structure-of-the-app" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>2. Structure of the app</h2><p>The user should  be able to do/see those things:</p><ul><li>Display all system contacts</li><li>Search contacts</li><li>Add a new contact</li><li>Show “details” of a contact (precise definition later)</li><li>Edit details of a contact</li></ul><p>The interactions for our three views would flow this way:</p><div class="darklight-0-0-1"><div class="dark"><p><img src="/blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/app-structure-dark.png" alt="App Interaction Flow"></p></div><div class="light"><p><img src="/blog/img/posts/swift-stuff/building-a-fully-working-contact-list-in-swiftui/app-structure-bright.png" alt="App Interaction Flow"></p></div></div><p>So, let's jump into actually building stuff!</p><h2 id="3-fetching-contacts" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>3. Fetching contacts</h2><h3 id="31-requesting-permissions" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>3.1. Requesting permissions</h3><p>To fetch contacts, we use the <a href="https://developer.apple.com/documentation/contacts">Contacts</a> API. As you may know, we first need to ask for permission to access the user’s contacts. This also requires us to add a string <a href="https://developer.apple.com/documentation/bundleresources/information_property_list/nscontactsusagedescription">describing the reason</a> in <code>Info.plist</code>, otherwise the app would crash. Add an entry for the key <code>NSContactsUsageDescription</code>.</p><p>Now, we can request contact access permissions this way:</p><pre class=""><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span></span></span><div class="line-0-0-19 " data-content="func fetchOrRequestPermission(completionHandler: @escaping (Bool) -> Void) {"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">func</span> <span class="token function">fetchOrRequestPermission</span><span class="token punctuation">(</span>completionHandler<span class="token punctuation">:</span> @escaping <span class="token punctuation">(</span><span class="token builtin">Bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    self.contactStore = CNContactStore.init()"><span class="lineCounter-0-0-18">2</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>contactStore <span class="token operator">=</span> <span class="token builtin">CNContactStore</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    self.contactStore!.requestAccess(for: .contacts) { success, error in"><span class="lineCounter-0-0-18">3</span>    <span class="token keyword">self</span><span class="token punctuation">.</span>contactStore<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>contacts<span class="token punctuation">)</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> error <span class="token keyword">in</span></div><br><div class="line-0-0-19 " data-content="        if (success) {"><span class="lineCounter-0-0-18">4</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            completionHandler(true)"><span class="lineCounter-0-0-18 prim">5</span>            <span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        } else {"><span class="lineCounter-0-0-18">6</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            completionHandler(false)"><span class="lineCounter-0-0-18">7</span>            <span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">8</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">9</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">10</span><span class="token punctuation">}</span></div><br></code></pre><p>Rightfully, you may ask what <code>self.contactStore</code> is for. We should wrap all our contact access functionality inside a class to access them in various places later. </p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactService.swift</span></span><div class="line-0-0-19 " data-content="class ContactService {"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">class</span> <span class="token class-name">ContactService</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">2</span></div><br><div class="line-0-0-19 " data-content="    var contactStore: CNContactStore?"><span class="lineCounter-0-0-18">3</span>    <span class="token keyword">var</span> contactStore<span class="token punctuation">:</span> <span class="token builtin">CNContactStore</span><span class="token operator">?</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">4</span></div><br><div class="line-0-0-19 " data-content="    func fetchOrRequestPermission(completionHandler: @escaping (Bool) -> Void) { "><span class="lineCounter-0-0-18 prim">5</span>    <span class="token keyword">func</span> <span class="token function">fetchOrRequestPermission</span><span class="token punctuation">(</span>completionHandler<span class="token punctuation">:</span> @escaping <span class="token punctuation">(</span><span class="token builtin">Bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </div><br><div class="line-0-0-19 " data-content="        // see above"><span class="lineCounter-0-0-18">6</span>        <span class="token comment">// see above</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">7</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">8</span><span class="token punctuation">}</span></div><br></code></pre><p>In my real-world app, I use a kind of <a href="https://medium.com/better-programming/implement-a-service-oriented-architecture-in-swift-5-fc70b8117616">singleton pattern</a>. As we're not discussing app architecture in this post, however, anything goes. There are arguments for and against using such a pattern, but for now, it relieved more pain than it inflicted on building our app.</p><h3 id="32-fetching-all-contacts" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>3.2. Fetching all contacts</h3><p>Now, we are able to fetch the user's contacts. I will explain the code using comments inside so it's easier to follow around.</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactService.swift</span></span><div class="line-0-0-19 " data-content="func getSystemContacts(completionHandler: @escaping ([Contact], Error?) -> Void) {"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">func</span> <span class="token function">getSystemContacts</span><span class="token punctuation">(</span>completionHandler<span class="token punctuation">:</span> @escaping <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">Contact</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">Error</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    self.fetchOrRequestPermission() { success in    // --> First, we need to make sure we have permission to fetch the contacts"><span class="lineCounter-0-0-18">2</span>    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">fetchOrRequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> success <span class="token keyword">in</span>    <span class="token comment">// --&gt; First, we need to make sure we have permission to fetch the contacts</span></div><br><div class="line-0-0-19 " data-content="        if (success) {"><span class="lineCounter-0-0-18">3</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            do {"><span class="lineCounter-0-0-18">4</span>            <span class="token keyword">do</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                let keysToFetch = [CNContactGivenNameKey, CNContactFamilyNameKey, CNContactPhoneNumbersKey] as [CNKeyDescriptor]    // --> The keysToFetch describe which content we actually want to access. It is good practice to keep this as limited as your app allows."><span class="lineCounter-0-0-18 prim">5</span>                <span class="token keyword">let</span> keysToFetch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">CNContactGivenNameKey</span><span class="token punctuation">,</span> <span class="token builtin">CNContactFamilyNameKey</span><span class="token punctuation">,</span> <span class="token builtin">CNContactPhoneNumbersKey</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token punctuation">[</span><span class="token builtin">CNKeyDescriptor</span><span class="token punctuation">]</span>    <span class="token comment">// --&gt; The keysToFetch describe which content we actually want to access. It is good practice to keep this as limited as your app allows.</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">6</span></div><br><div class="line-0-0-19 " data-content="                var contacts = [CNContact]()"><span class="lineCounter-0-0-18">7</span>                <span class="token keyword">var</span> contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">CNContact</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">8</span></div><br><div class="line-0-0-19 " data-content="                let request = CNContactFetchRequest(keysToFetch: keysToFetch)"><span class="lineCounter-0-0-18">9</span>                <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token function">CNContactFetchRequest</span><span class="token punctuation">(</span>keysToFetch<span class="token punctuation">:</span> keysToFetch<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">10</span></div><br><div class="line-0-0-19 " data-content="                try self.contactStore!.enumerateContacts(with: request) {"><span class="lineCounter-0-0-18">11</span>                <span class="token keyword">try</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contactStore<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">enumerateContacts</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                    (contact, stop) in"><span class="lineCounter-0-0-18">12</span>                    <span class="token punctuation">(</span>contact<span class="token punctuation">,</span> stop<span class="token punctuation">)</span> <span class="token keyword">in</span></div><br><div class="line-0-0-19 " data-content="                    contacts.append(contact)"><span class="lineCounter-0-0-18">13</span>                    contacts<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>contact<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                }"><span class="lineCounter-0-0-18">14</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">15</span></div><br><div class="line-0-0-19 " data-content="                func getName(_ contact: Contact) -> String { // --> see below for the Contact model and why we implement one"><span class="lineCounter-0-0-18">16</span>                <span class="token keyword">func</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token number">_</span> contact<span class="token punctuation">:</span> <span class="token builtin">Contact</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">String</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; see below for the Contact model and why we implement one</span></div><br><div class="line-0-0-19 " data-content="                    return contact.lastName.count > 0 ? contact.lastName : contact.givenName    // --> essentially, this is some sugar to order the contacts, as we often want to have them already ordered and not do it inside the model"><span class="lineCounter-0-0-18">17</span>                    <span class="token keyword">return</span> contact<span class="token punctuation">.</span>lastName<span class="token punctuation">.</span><span class="token builtin">count</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> contact<span class="token punctuation">.</span>lastName <span class="token punctuation">:</span> contact<span class="token punctuation">.</span>givenName    <span class="token comment">// --&gt; essentially, this is some sugar to order the contacts, as we often want to have them already ordered and not do it inside the model</span></div><br><div class="line-0-0-19 " data-content="                }"><span class="lineCounter-0-0-18">18</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">19</span></div><br><div class="line-0-0-19 " data-content="                let formatted = contacts.compactMap({"><span class="lineCounter-0-0-18 prim">20</span>                <span class="token keyword">let</span> formatted <span class="token operator">=</span> contacts<span class="token punctuation">.</span><span class="token function">compactMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                    // filter out all &quot;empty&quot; contacts"><span class="lineCounter-0-0-18">21</span>                    <span class="token comment">// filter out all "empty" contacts</span></div><br><div class="line-0-0-19 " data-content="                    if ($0.phoneNumbers.count > 0 &amp;&amp; ($0.givenName.count > 0 || $0.familyName.count > 0)) { // --> This is a fun one. On multiple different devices I have encountered those &quot;empty contacts&quot; where no information is stored for some reason. We don't need them so they're filtered out as well."><span class="lineCounter-0-0-18">22</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token number">0</span><span class="token punctuation">.</span>phoneNumbers<span class="token punctuation">.</span><span class="token builtin">count</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>$<span class="token number">0</span><span class="token punctuation">.</span>givenName<span class="token punctuation">.</span><span class="token builtin">count</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> $<span class="token number">0</span><span class="token punctuation">.</span>familyName<span class="token punctuation">.</span><span class="token builtin">count</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; This is a fun one. On multiple different devices I have encountered those "empty contacts" where no information is stored for some reason. We don't need them so they're filtered out as well.</span></div><br><div class="line-0-0-19 " data-content="                        return Contact.fromCNContact(contact: $0)"><span class="lineCounter-0-0-18">23</span>                        <span class="token keyword">return</span> <span class="token builtin">Contact</span><span class="token punctuation">.</span><span class="token function">fromCNContact</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> $<span class="token number">0</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                    }"><span class="lineCounter-0-0-18">24</span>                    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">25</span></div><br><div class="line-0-0-19 " data-content="                    return nil"><span class="lineCounter-0-0-18">26</span>                    <span class="token keyword">return</span> <span class="token constant">nil</span></div><br><div class="line-0-0-19 " data-content="                })"><span class="lineCounter-0-0-18">27</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                        .sorted(by: { getName($0) < getName($1) }) // --> order by lastname/firstname"><span class="lineCounter-0-0-18">28</span>                        <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token function">getName</span><span class="token punctuation">(</span>$<span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">getName</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; order by lastname/firstname</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">29</span></div><br><div class="line-0-0-19 " data-content="                    completionHandler(formatted, nil)"><span class="lineCounter-0-0-18 prim">30</span>                    <span class="token function">completionHandler</span><span class="token punctuation">(</span>formatted<span class="token punctuation">,</span> <span class="token constant">nil</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            } catch {"><span class="lineCounter-0-0-18">31</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                print(&quot;Failed to fetch contact, error: \(error)&quot;)"><span class="lineCounter-0-0-18">32</span>                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Failed to fetch contact, error: <span class="token interpolation"><span class="token delimiter variable">\(</span>error<span class="token delimiter variable">)</span></span>"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                completionHandler([], NSError()) // --> as a fallback, we return an empty array but we should capture the error elsewhere"><span class="lineCounter-0-0-18">33</span>                <span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">NSError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; as a fallback, we return an empty array but we should capture the error elsewhere</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">34</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="        } else {"><span class="lineCounter-0-0-18 prim">35</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            completionHandler([], NSError()) // --> also, please don't just return empty errors, I was lazy because I know where the error is coming from, but you maybe will not or can't remember why"><span class="lineCounter-0-0-18">36</span>            <span class="token function">completionHandler</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">NSError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; also, please don't just return empty errors, I was lazy because I know where the error is coming from, but you maybe will not or can't remember why</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">37</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">38</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">39</span><span class="token punctuation">}</span></div><br></code></pre><h3 id="33-the-contact-model" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>3.3. The <strong>Contact</strong> model</h3><p>By default, the Contacts API returns a <a href="https://developer.apple.com/documentation/contacts/cncontact">CNContact</a>. This is a great class and provides a versatile feature set. But to make it easier, I convert it into my own contact model to keep it concise and make the expectations clear for other developers on which fields they can expect to work with. This model will probably grow with your app (as it did for mine) but it's a good starting point. </p><p>It's also good to put an abstraction between the layers in case you have some non-system sourced contacts like from your app's cloud-based address book.</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>Contact.swift</span></span><div class="line-0-0-19 " data-content="struct Contact {"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">struct</span> <span class="token builtin">Contact</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    var id = UUID()"><span class="lineCounter-0-0-18">2</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    var givenName: String"><span class="lineCounter-0-0-18">3</span>    <span class="token keyword">var</span> givenName<span class="token punctuation">:</span> <span class="token builtin">String</span></div><br><div class="line-0-0-19 " data-content="    var lastName: String"><span class="lineCounter-0-0-18">4</span>    <span class="token keyword">var</span> lastName<span class="token punctuation">:</span> <span class="token builtin">String</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">5</span></div><br><div class="line-0-0-19 " data-content="    var numbers: [PhoneNumber]"><span class="lineCounter-0-0-18">6</span>    <span class="token keyword">var</span> numbers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">PhoneNumber</span><span class="token punctuation">]</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">7</span></div><br><div class="line-0-0-19 " data-content="    var systemContact: CNContact? // --> This one is important! We keep a reference to later make it easier for editing the same contact."><span class="lineCounter-0-0-18">8</span>    <span class="token keyword">var</span> systemContact<span class="token punctuation">:</span> <span class="token builtin">CNContact</span><span class="token operator">?</span> <span class="token comment">// --&gt; This one is important! We keep a reference to later make it easier for editing the same contact.</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">9</span></div><br><div class="line-0-0-19 " data-content="    struct PhoneNumber { // --> We also have a PhoneNumber struct as they can have labels and we want to display them"><span class="lineCounter-0-0-18 prim">10</span>    <span class="token keyword">struct</span> <span class="token builtin">PhoneNumber</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; We also have a PhoneNumber struct as they can have labels and we want to display them</span></div><br><div class="line-0-0-19 " data-content="        var label: String"><span class="lineCounter-0-0-18">11</span>        <span class="token keyword">var</span> label<span class="token punctuation">:</span> <span class="token builtin">String</span></div><br><div class="line-0-0-19 " data-content="        var number: String"><span class="lineCounter-0-0-18">12</span>        <span class="token keyword">var</span> number<span class="token punctuation">:</span> <span class="token builtin">String</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">13</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">14</span></div><br><div class="line-0-0-19 " data-content="    init(givenName: String, lastName: String, numbers: [PhoneNumber], systemContact: CNContact) {"><span class="lineCounter-0-0-18 prim">15</span>    <span class="token keyword">init</span><span class="token punctuation">(</span>givenName<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> lastName<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> numbers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">PhoneNumber</span><span class="token punctuation">]</span><span class="token punctuation">,</span> systemContact<span class="token punctuation">:</span> <span class="token builtin">CNContact</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self.givenName = givenName"><span class="lineCounter-0-0-18">16</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>givenName <span class="token operator">=</span> givenName</div><br><div class="line-0-0-19 " data-content="        self.lastName = lastName"><span class="lineCounter-0-0-18">17</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName</div><br><div class="line-0-0-19 " data-content="        self.numbers = numbers"><span class="lineCounter-0-0-18">18</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>numbers <span class="token operator">=</span> numbers</div><br><div class="line-0-0-19 " data-content="        self.systemContact = systemContact"><span class="lineCounter-0-0-18">19</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>systemContact <span class="token operator">=</span> systemContact</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18 prim">20</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">21</span></div><br><div class="line-0-0-19 " data-content="    init(givenName: String, lastName: String, numbers: [PhoneNumber]) {"><span class="lineCounter-0-0-18">22</span>    <span class="token keyword">init</span><span class="token punctuation">(</span>givenName<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> lastName<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> numbers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">PhoneNumber</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self.givenName = givenName"><span class="lineCounter-0-0-18">23</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>givenName <span class="token operator">=</span> givenName</div><br><div class="line-0-0-19 " data-content="        self.lastName = lastName"><span class="lineCounter-0-0-18">24</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName</div><br><div class="line-0-0-19 " data-content="        self.numbers = numbers"><span class="lineCounter-0-0-18 prim">25</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>numbers <span class="token operator">=</span> numbers</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">26</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">27</span></div><br><div class="line-0-0-19 " data-content="    static func fromCNContact(contact: CNContact) -> Contact {"><span class="lineCounter-0-0-18">28</span>    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function">fromCNContact</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token builtin">CNContact</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Contact</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        let numbers = contact.phoneNumbers.map({"><span class="lineCounter-0-0-18">29</span>        <span class="token keyword">let</span> numbers <span class="token operator">=</span> contact<span class="token punctuation">.</span>phoneNumbers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            (value: CNLabeledValue<CNPhoneNumber>) -> Contact.PhoneNumber in"><span class="lineCounter-0-0-18 prim">30</span>            <span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token builtin">CNLabeledValue</span><span class="token operator">&lt;</span><span class="token builtin">CNPhoneNumber</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Contact</span><span class="token punctuation">.</span><span class="token builtin">PhoneNumber</span> <span class="token keyword">in</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">31</span></div><br><div class="line-0-0-19 " data-content="            let localized = CNLabeledValue<NSString>.localizedString(forLabel: value.label ?? &quot;&quot;)"><span class="lineCounter-0-0-18">32</span>            <span class="token keyword">let</span> localized <span class="token operator">=</span> <span class="token builtin">CNLabeledValue</span><span class="token operator">&lt;</span><span class="token builtin">NSString</span><span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">localizedString</span><span class="token punctuation">(</span>forLabel<span class="token punctuation">:</span> value<span class="token punctuation">.</span>label <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">""</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">33</span></div><br><div class="line-0-0-19 " data-content="            return Contact.PhoneNumber.init(label: localized, number: value.value.stringValue)"><span class="lineCounter-0-0-18">34</span>            <span class="token keyword">return</span> <span class="token builtin">Contact</span><span class="token punctuation">.</span><span class="token builtin">PhoneNumber</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> localized<span class="token punctuation">,</span> number<span class="token punctuation">:</span> value<span class="token punctuation">.</span>value<span class="token punctuation">.</span>stringValue<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">35</span></div><br><div class="line-0-0-19 " data-content="        })"><span class="lineCounter-0-0-18">36</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">37</span></div><br><div class="line-0-0-19 " data-content="        return self.init(givenName: contact.givenName, lastName: contact.familyName, numbers: numbers, systemContact: contact)"><span class="lineCounter-0-0-18">38</span>        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>givenName<span class="token punctuation">:</span> contact<span class="token punctuation">.</span>givenName<span class="token punctuation">,</span> lastName<span class="token punctuation">:</span> contact<span class="token punctuation">.</span>familyName<span class="token punctuation">,</span> numbers<span class="token punctuation">:</span> numbers<span class="token punctuation">,</span> systemContact<span class="token punctuation">:</span> contact<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">39</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">40</span></div><br><div class="line-0-0-19 " data-content="    func fullName() -> String {"><span class="lineCounter-0-0-18">41</span>    <span class="token keyword">func</span> <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">String</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        return &quot;\(self.givenName) \(self.lastName)&quot;"><span class="lineCounter-0-0-18">42</span>        <span class="token keyword">return</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token keyword">self</span><span class="token punctuation">.</span>givenName<span class="token delimiter variable">)</span></span> <span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token keyword">self</span><span class="token punctuation">.</span>lastName<span class="token delimiter variable">)</span></span>"</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">43</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">44</span><span class="token punctuation">}</span></div><br></code></pre><p>That's it for fetching contacts! </p><h2 id="4-main-view" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>4. Main view</h2><p>Let's get visual now. It's already time to build our first view. The main view (as in: the contact list) is the starting point of our app.</p><p>But actually, we'll start with the view model first and then use it to display our view. </p><h3 id="41-view-model" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>4.1. View model</h3><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactListViewModel.swift</span></span><div class="line-0-0-19 " data-content="import Foundation"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">import</span> <span class="token builtin">Foundation</span></div><br><div class="line-0-0-19 " data-content="import Contacts"><span class="lineCounter-0-0-18">2</span><span class="token keyword">import</span> <span class="token builtin">Contacts</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">3</span></div><br><div class="line-0-0-19 " data-content="class ContactListViewModel: ObservableObject {"><span class="lineCounter-0-0-18">4</span><span class="token keyword">class</span> <span class="token class-name">ContactListViewModel</span><span class="token punctuation">:</span> <span class="token builtin">ObservableObject</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    var contactService = ServiceRegistry.contactService // --> here, you pull in the ContactService we've built"><span class="lineCounter-0-0-18 prim">5</span>    <span class="token keyword">var</span> contactService <span class="token operator">=</span> <span class="token builtin">ServiceRegistry</span><span class="token punctuation">.</span>contactService <span class="token comment">// --&gt; here, you pull in the ContactService we've built</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">6</span></div><br><div class="line-0-0-19 " data-content="    @Published var newContact = CNContact() // --> I'll come back to this later when we talk about editing and creating new contacts"><span class="lineCounter-0-0-18">7</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> newContact <span class="token operator">=</span> <span class="token function">CNContact</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; I'll come back to this later when we talk about editing and creating new contacts</span></div><br><div class="line-0-0-19 " data-content="    @Published var contacts: [Contact] = []"><span class="lineCounter-0-0-18">8</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> contacts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">Contact</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></div><br><div class="line-0-0-19 " data-content="    @Published var showNewContact = false // --> This is for the modal"><span class="lineCounter-0-0-18">9</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> showNewContact <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// --&gt; This is for the modal</span></div><br><div class="line-0-0-19 " data-content="    @Published var noPermission = false // --> Also, we should display a hint when the user hasn't granted permission so they know what's going on"><span class="lineCounter-0-0-18 prim">10</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> noPermission <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// --&gt; Also, we should display a hint when the user hasn't granted permission so they know what's going on</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">11</span></div><br><div class="line-0-0-19 " data-content="    @Published var searchText = &quot;&quot; // --> this is for the search we're going to implement"><span class="lineCounter-0-0-18">12</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> searchText <span class="token operator">=</span> <span class="token string">""</span> <span class="token comment">// --&gt; this is for the search we're going to implement</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">13</span></div><br><div class="line-0-0-19 " data-content="    init() {"><span class="lineCounter-0-0-18">14</span>    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self.fetch()"><span class="lineCounter-0-0-18 prim">15</span>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">16</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">17</span></div><br><div class="line-0-0-19 " data-content="    func fetch() {"><span class="lineCounter-0-0-18">18</span>    <span class="token keyword">func</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self.contactService.getSystemContacts { (contacts, error) in"><span class="lineCounter-0-0-18">19</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>contactService<span class="token punctuation">.</span>getSystemContacts <span class="token punctuation">{</span> <span class="token punctuation">(</span>contacts<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span></div><br><div class="line-0-0-19 " data-content="            guard error == nil else {"><span class="lineCounter-0-0-18 prim">20</span>            <span class="token keyword">guard</span> error <span class="token operator">==</span> <span class="token constant">nil</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                self.contacts = []"><span class="lineCounter-0-0-18">21</span>                <span class="token keyword">self</span><span class="token punctuation">.</span>contacts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></div><br><div class="line-0-0-19 " data-content="                self.noPermission = true"><span class="lineCounter-0-0-18">22</span>                <span class="token keyword">self</span><span class="token punctuation">.</span>noPermission <span class="token operator">=</span> <span class="token boolean">true</span></div><br><div class="line-0-0-19 " data-content="                return"><span class="lineCounter-0-0-18">23</span>                <span class="token keyword">return</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">24</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">25</span></div><br><div class="line-0-0-19 " data-content="            self.contacts = contacts // --> Because we're doing the heavy lifting inside the service, it takes almost no steps to fetch the contacts"><span class="lineCounter-0-0-18">26</span>            <span class="token keyword">self</span><span class="token punctuation">.</span>contacts <span class="token operator">=</span> contacts <span class="token comment">// --&gt; Because we're doing the heavy lifting inside the service, it takes almost no steps to fetch the contacts</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">27</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">28</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">29</span></div><br><div class="line-0-0-19 " data-content="    private func contactFilter(contact: Contact) -> Bool {"><span class="lineCounter-0-0-18 prim">30</span>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function">contactFilter</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token builtin">Contact</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        if self.searchText.count == 0 {"><span class="lineCounter-0-0-18">31</span>        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>searchText<span class="token punctuation">.</span><span class="token builtin">count</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            return true"><span class="lineCounter-0-0-18">32</span>            <span class="token keyword">return</span> <span class="token boolean">true</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">33</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">34</span></div><br><div class="line-0-0-19 " data-content="        return contact.fullName().localizedCaseInsensitiveContains(self.searchText)"><span class="lineCounter-0-0-18 prim">35</span>        <span class="token keyword">return</span> contact<span class="token punctuation">.</span><span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">localizedCaseInsensitiveContains</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>searchText<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">36</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">37</span><span class="token punctuation">}</span></div><br></code></pre><h3 id="42-view" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>4.2. View</h3><p>Now, let's take a look at the view displaying our lovely contacts.</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactList.swift</span></span><div class="line-0-0-19 " data-content="import SwiftUI"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">2</span></div><br><div class="line-0-0-19 " data-content="struct ContactList: View {"><span class="lineCounter-0-0-18">3</span><span class="token keyword">struct</span> <span class="token builtin">ContactList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    @ObservedObject var viewModel = ContactListViewModel()"><span class="lineCounter-0-0-18">4</span>    @<span class="token builtin">ObservedObject</span> <span class="token keyword">var</span> viewModel <span class="token operator">=</span> <span class="token function">ContactListViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">5</span></div><br><div class="line-0-0-19 " data-content="    var body: some View {"><span class="lineCounter-0-0-18">6</span>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="         VStack {"><span class="lineCounter-0-0-18">7</span>         <span class="token builtin">VStack</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            SearchBar(text: $searchText, placeholder: &quot;Search contacts&quot;) // --> see below how to build this"><span class="lineCounter-0-0-18">8</span>            <span class="token function">SearchBar</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $searchText<span class="token punctuation">,</span> placeholder<span class="token punctuation">:</span> <span class="token string">"Search contacts"</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; see below how to build this</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">9</span></div><br><div class="line-0-0-19 " data-content="            List {"><span class="lineCounter-0-0-18 prim">10</span>            <span class="token builtin">List</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                // Filtered list of names"><span class="lineCounter-0-0-18">11</span>                <span class="token comment">// Filtered list of names</span></div><br><div class="line-0-0-19 " data-content="                ForEach(contacts.filter { contactFilter(contact: $0)}, id:\.id) {contact in // --> We display all filtered contacts"><span class="lineCounter-0-0-18">12</span>                <span class="token function">ForEach</span><span class="token punctuation">(</span>contacts<span class="token punctuation">.</span><span class="token builtin">filter</span> <span class="token punctuation">{</span> <span class="token function">contactFilter</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> $<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span>\<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>contact <span class="token keyword">in</span> <span class="token comment">// --&gt; We display all filtered contacts</span></div><br><div class="line-0-0-19 " data-content="                    NavigationLink(destination: ContactDetailView(contact: contact)) {"><span class="lineCounter-0-0-18">13</span>                    <span class="token function">NavigationLink</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">ContactDetailView</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> contact<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                        ContactItem(contact: contact)"><span class="lineCounter-0-0-18">14</span>                        <span class="token function">ContactItem</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> contact<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                    }"><span class="lineCounter-0-0-18 prim">15</span>                    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="                }"><span class="lineCounter-0-0-18">16</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">17</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="            .modifier(ResignKeyboardOnDragGesture())"><span class="lineCounter-0-0-18">18</span>            <span class="token punctuation">.</span><span class="token function">modifier</span><span class="token punctuation">(</span><span class="token function">ResignKeyboardOnDragGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">19</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18 prim">20</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">21</span><span class="token punctuation">}</span></div><br></code></pre><p><strong>So, what is actually happening here?</strong></p><h3 id="43-contactitem-basic-list-item" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>4.3. ContactItem: Basic list item</h3><p>SwiftUI makes it easy to break views into reusable components, so we tidy up our app a bit by putting <code>ContactItem</code> in a separate view.</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactItem.swift</span></span><div class="line-0-0-19 " data-content="struct ContactItem: View {"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">struct</span> <span class="token builtin">ContactItem</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    var contact: Contact"><span class="lineCounter-0-0-18">2</span>    <span class="token keyword">var</span> contact<span class="token punctuation">:</span> <span class="token builtin">Contact</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">3</span></div><br><div class="line-0-0-19 " data-content="    var body: some View {"><span class="lineCounter-0-0-18">4</span>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        VStack(alignment: .leading, spacing: 5) {"><span class="lineCounter-0-0-18 prim">5</span>        <span class="token function">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            HStack(spacing: 5) {"><span class="lineCounter-0-0-18">6</span>            <span class="token function">HStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                Text(contact.givenName)"><span class="lineCounter-0-0-18">7</span>                <span class="token function">Text</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span>givenName<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                Text(contact.lastName)"><span class="lineCounter-0-0-18">8</span>                <span class="token function">Text</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">9</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18 prim">10</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">11</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18">12</span><span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">13</span></div><br></code></pre><h3 id="44-searchbar-interfacing-with-uikit" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>4.4. SearchBar: Interfacing with UIKit</h3><p>We're pulling in a <code>SearchBar</code>. This view will interface with UIKit and display the <a href="https://developer.apple.com/documentation/uikit/uisearchbar"><code>UISearchBar</code></a>, which is already pre-made by Apple. Let's take a look.</p><p>I highly recommend taking a look at the <a href="https://developer.apple.com/tutorials/swiftui/interfacing-with-uikit">Interfacing with UIKit</a> guide by Apple if you've never integrated a UIKit view before.</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>SearchBar.swift</span></span><div class="line-0-0-19 " data-content="import SwiftUI"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">2</span></div><br><div class="line-0-0-19 " data-content="struct SearchBar: UIViewRepresentable {"><span class="lineCounter-0-0-18">3</span><span class="token keyword">struct</span> <span class="token builtin">SearchBar</span><span class="token punctuation">:</span> <span class="token builtin">UIViewRepresentable</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    @Binding var text: String"><span class="lineCounter-0-0-18">4</span>    @<span class="token builtin">Binding</span> <span class="token keyword">var</span> text<span class="token punctuation">:</span> <span class="token builtin">String</span></div><br><div class="line-0-0-19 " data-content="    var placeholder: String?"><span class="lineCounter-0-0-18 prim">5</span>    <span class="token keyword">var</span> placeholder<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token operator">?</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">6</span></div><br><div class="line-0-0-19 " data-content="    class Coordinator: NSObject, UISearchBarDelegate {"><span class="lineCounter-0-0-18">7</span>    <span class="token keyword">class</span> <span class="token class-name">Coordinator</span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span><span class="token punctuation">,</span> <span class="token builtin">UISearchBarDelegate</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">8</span></div><br><div class="line-0-0-19 " data-content="        @Binding var text: String"><span class="lineCounter-0-0-18">9</span>        @<span class="token builtin">Binding</span> <span class="token keyword">var</span> text<span class="token punctuation">:</span> <span class="token builtin">String</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">10</span></div><br><div class="line-0-0-19 " data-content="        init(text: Binding<String>) {"><span class="lineCounter-0-0-18">11</span>        <span class="token keyword">init</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token builtin">Binding</span><span class="token operator">&lt;</span><span class="token builtin">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            _text = text"><span class="lineCounter-0-0-18">12</span>            _text <span class="token operator">=</span> text</div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">13</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">14</span></div><br><div class="line-0-0-19 " data-content="        func searchBar(_ searchBar: UISearchBar, textDidChange searchText: String) {"><span class="lineCounter-0-0-18 prim">15</span>        <span class="token keyword">func</span> <span class="token function">searchBar</span><span class="token punctuation">(</span><span class="token number">_</span> searchBar<span class="token punctuation">:</span> <span class="token builtin">UISearchBar</span><span class="token punctuation">,</span> textDidChange searchText<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            text = searchText"><span class="lineCounter-0-0-18">16</span>            text <span class="token operator">=</span> searchText</div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">17</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">18</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">19</span></div><br><div class="line-0-0-19 " data-content="    func makeCoordinator() -> SearchBar.Coordinator {"><span class="lineCounter-0-0-18 prim">20</span>    <span class="token keyword">func</span> <span class="token function">makeCoordinator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">SearchBar</span><span class="token punctuation">.</span><span class="token builtin">Coordinator</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        return Coordinator(text: $text)"><span class="lineCounter-0-0-18">21</span>        <span class="token keyword">return</span> <span class="token function">Coordinator</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $text<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">22</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">23</span></div><br><div class="line-0-0-19 " data-content="    func makeUIView(context: UIViewRepresentableContext<SearchBar>) -> UISearchBar {"><span class="lineCounter-0-0-18">24</span>    <span class="token keyword">func</span> <span class="token function">makeUIView</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> <span class="token builtin">UIViewRepresentableContext</span><span class="token operator">&lt;</span><span class="token builtin">SearchBar</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UISearchBar</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        let searchBar = UISearchBar(frame: .zero)"><span class="lineCounter-0-0-18 prim">25</span>        <span class="token keyword">let</span> searchBar <span class="token operator">=</span> <span class="token function">UISearchBar</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        searchBar.delegate = context.coordinator"><span class="lineCounter-0-0-18">26</span>        searchBar<span class="token punctuation">.</span>delegate <span class="token operator">=</span> context<span class="token punctuation">.</span>coordinator</div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">27</span></div><br><div class="line-0-0-19 " data-content="        searchBar.autocapitalizationType = .none // --> here, we make some adjustments to the view so it better fits to our app"><span class="lineCounter-0-0-18">28</span>        searchBar<span class="token punctuation">.</span>autocapitalizationType <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">none</span> <span class="token comment">// --&gt; here, we make some adjustments to the view so it better fits to our app</span></div><br><div class="line-0-0-19 " data-content="        searchBar.searchBarStyle = .minimal"><span class="lineCounter-0-0-18">29</span>        searchBar<span class="token punctuation">.</span>searchBarStyle <span class="token operator">=</span> <span class="token punctuation">.</span>minimal</div><br><div class="line-0-0-19 " data-content="        searchBar.placeholder = placeholder"><span class="lineCounter-0-0-18 prim">30</span>        searchBar<span class="token punctuation">.</span>placeholder <span class="token operator">=</span> placeholder</div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">31</span></div><br><div class="line-0-0-19 " data-content="        return searchBar"><span class="lineCounter-0-0-18">32</span>        <span class="token keyword">return</span> searchBar</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">33</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">34</span></div><br><div class="line-0-0-19 " data-content="    func updateUIView(_ uiView: UISearchBar, context: UIViewRepresentableContext<SearchBar>) {"><span class="lineCounter-0-0-18 prim">35</span>    <span class="token keyword">func</span> <span class="token function">updateUIView</span><span class="token punctuation">(</span><span class="token number">_</span> uiView<span class="token punctuation">:</span> <span class="token builtin">UISearchBar</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token builtin">UIViewRepresentableContext</span><span class="token operator">&lt;</span><span class="token builtin">SearchBar</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        uiView.text = text"><span class="lineCounter-0-0-18">36</span>        uiView<span class="token punctuation">.</span>text <span class="token operator">=</span> text</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">37</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">38</span><span class="token punctuation">}</span></div><br></code></pre><p>That's it for the <code>SearchBar</code>, it provides us with all the functions we expect of a basic search bar. Also, we basically get search for free as seen in the view model.</p><p>Now, we should take a look at creating a new contact first before showing some details on our contacts, so I'll discuss <code>ContactDetailView</code> later.</p><h2 id="5-creating-a-new-contact" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>5. Creating a new contact</h2><p>It's time to add a button for contact creation now.</p><p>Add those modifiers to the <code>VStack</code> inside the <code>ContactList</code>:</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactList.swift</span></span><div class="line-0-0-19 " data-content=".navigationBarItems(trailing:"><span class="lineCounter-0-0-18 prim">1</span><span class="token punctuation">.</span><span class="token function">navigationBarItems</span><span class="token punctuation">(</span>trailing<span class="token punctuation">:</span></div><br><div class="line-0-0-19 " data-content="    Button(action: { self.viewModel.showNewContact = true }) {"><span class="lineCounter-0-0-18">2</span>    <span class="token function">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span>showNewContact <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        Image(systemName: &quot;person.crop.circle.badge.plus&quot;)"><span class="lineCounter-0-0-18">3</span>        <span class="token function">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string">"person.crop.circle.badge.plus"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            .resizable()"><span class="lineCounter-0-0-18">4</span>            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            .scaledToFit()"><span class="lineCounter-0-0-18 prim">5</span>            <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            .frame(width: 20)"><span class="lineCounter-0-0-18">6</span>            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18">7</span><span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=".sheet(isPresented: self.$viewModel.showNewContact, onDismiss: { self.viewModel.fetch() }) {"><span class="lineCounter-0-0-18">8</span><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>$viewModel<span class="token punctuation">.</span>showNewContact<span class="token punctuation">,</span> onDismiss<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    NavigationView() {"><span class="lineCounter-0-0-18">9</span>    <span class="token function">NavigationView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        EditContactView(contact: self.$viewModel.newContact) // --> We'll get to that now"><span class="lineCounter-0-0-18 prim">10</span>        <span class="token function">EditContactView</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>$viewModel<span class="token punctuation">.</span>newContact<span class="token punctuation">)</span> <span class="token comment">// --&gt; We'll get to that now</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">11</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18">12</span><span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=".disabled(self.viewModel.noPermission)) // --> The user can't add any contacts inside our app if we have no permissions, so disable the button"><span class="lineCounter-0-0-18 prim">13</span><span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span>noPermission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; The user can't add any contacts inside our app if we have no permissions, so disable the button</span></div><br></code></pre><h3 id="51-editcontactview-some-more-uikit-interfacing" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>5.1. EditContactView: Some more UIKit interfacing!</h3><p>UIKit provides a view (<a href="https://developer.apple.com/documentation/contactsui/cncontactviewcontroller">CNContactViewController</a>) we can use to create/edit contacts. This is great becasue we don't need to write our own and it makes sure that we can adapt to new versions of iOS relatively quickly.</p><p>It's mostly the same as for <a href="#44-searchbar-interfacing-with-uikit">4.4. SearchBar</a>, but obviously with some adjustments.</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>EditContactView.swift</span></span><div class="line-0-0-19 " data-content="import Foundation"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">import</span> <span class="token builtin">Foundation</span></div><br><div class="line-0-0-19 " data-content="import SwiftUI"><span class="lineCounter-0-0-18">2</span><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span></div><br><div class="line-0-0-19 " data-content="import ContactsUI"><span class="lineCounter-0-0-18">3</span><span class="token keyword">import</span> <span class="token builtin">ContactsUI</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">4</span></div><br><div class="line-0-0-19 " data-content="struct EditContactView: UIViewControllerRepresentable {"><span class="lineCounter-0-0-18 prim">5</span><span class="token keyword">struct</span> <span class="token builtin">EditContactView</span><span class="token punctuation">:</span> <span class="token builtin">UIViewControllerRepresentable</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    class Coordinator: NSObject, CNContactViewControllerDelegate, UINavigationControllerDelegate {"><span class="lineCounter-0-0-18">6</span>    <span class="token keyword">class</span> <span class="token class-name">Coordinator</span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span><span class="token punctuation">,</span> <span class="token builtin">CNContactViewControllerDelegate</span><span class="token punctuation">,</span> <span class="token builtin">UINavigationControllerDelegate</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        func contactViewController(_ viewController: CNContactViewController, didCompleteWith contact: CNContact?) { // --> this gets called when the user taps done or cancels the editing/creation of a contact"><span class="lineCounter-0-0-18">7</span>        <span class="token keyword">func</span> <span class="token function">contactViewController</span><span class="token punctuation">(</span><span class="token number">_</span> viewController<span class="token punctuation">:</span> <span class="token builtin">CNContactViewController</span><span class="token punctuation">,</span> didCompleteWith contact<span class="token punctuation">:</span> <span class="token builtin">CNContact</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; this gets called when the user taps done or cancels the editing/creation of a contact</span></div><br><div class="line-0-0-19 " data-content="            if let c = contact {"><span class="lineCounter-0-0-18">8</span>            <span class="token keyword">if</span> <span class="token keyword">let</span> c <span class="token operator">=</span> contact <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                self.parent.contact = c"><span class="lineCounter-0-0-18">9</span>                <span class="token keyword">self</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>contact <span class="token operator">=</span> c</div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18 prim">10</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">11</span></div><br><div class="line-0-0-19 " data-content="            viewController.dismiss(animated: true)"><span class="lineCounter-0-0-18">12</span>            viewController<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span>animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">13</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">14</span></div><br><div class="line-0-0-19 " data-content="        var parent: EditContactView"><span class="lineCounter-0-0-18 prim">15</span>        <span class="token keyword">var</span> parent<span class="token punctuation">:</span> <span class="token builtin">EditContactView</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">16</span></div><br><div class="line-0-0-19 " data-content="        init(_ parent: EditContactView) {"><span class="lineCounter-0-0-18">17</span>        <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token number">_</span> parent<span class="token punctuation">:</span> <span class="token builtin">EditContactView</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            self.parent = parent"><span class="lineCounter-0-0-18">18</span>            <span class="token keyword">self</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent</div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">19</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18 prim">20</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">21</span></div><br><div class="line-0-0-19 " data-content="    @Binding var contact: CNContact"><span class="lineCounter-0-0-18">22</span>    @<span class="token builtin">Binding</span> <span class="token keyword">var</span> contact<span class="token punctuation">:</span> <span class="token builtin">CNContact</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">23</span></div><br><div class="line-0-0-19 " data-content="    init(contact: Binding<CNContact>) {"><span class="lineCounter-0-0-18">24</span>    <span class="token keyword">init</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token builtin">Binding</span><span class="token operator">&lt;</span><span class="token builtin">CNContact</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self._contact = contact"><span class="lineCounter-0-0-18 prim">25</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>_contact <span class="token operator">=</span> contact</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">26</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">27</span></div><br><div class="line-0-0-19 " data-content="    typealias UIViewControllerType = CNContactViewController"><span class="lineCounter-0-0-18">28</span>    <span class="token keyword">typealias</span> <span class="token builtin">UIViewControllerType</span> <span class="token operator">=</span> <span class="token builtin">CNContactViewController</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">29</span></div><br><div class="line-0-0-19 " data-content="    func makeCoordinator() -> Coordinator {"><span class="lineCounter-0-0-18 prim">30</span>    <span class="token keyword">func</span> <span class="token function">makeCoordinator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Coordinator</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        return Coordinator(self)"><span class="lineCounter-0-0-18">31</span>        <span class="token keyword">return</span> <span class="token function">Coordinator</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">32</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">33</span></div><br><div class="line-0-0-19 " data-content="    func makeUIViewController(context: UIViewControllerRepresentableContext<EditContactView>) -> EditContactView.UIViewControllerType {"><span class="lineCounter-0-0-18">34</span>    <span class="token keyword">func</span> <span class="token function">makeUIViewController</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerRepresentableContext</span><span class="token operator">&lt;</span><span class="token builtin">EditContactView</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">EditContactView</span><span class="token punctuation">.</span><span class="token builtin">UIViewControllerType</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        if self.contact.identifier.count != 0 { // --> for editing: here, we check if the contact is actually empty (so, a new one) or already exists"><span class="lineCounter-0-0-18 prim">35</span>        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contact<span class="token punctuation">.</span>identifier<span class="token punctuation">.</span><span class="token builtin">count</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; for editing: here, we check if the contact is actually empty (so, a new one) or already exists</span></div><br><div class="line-0-0-19 " data-content="            do {"><span class="lineCounter-0-0-18">36</span>            <span class="token keyword">do</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                let descriptor = CNContactViewController.descriptorForRequiredKeys()"><span class="lineCounter-0-0-18">37</span>                <span class="token keyword">let</span> descriptor <span class="token operator">=</span> <span class="token builtin">CNContactViewController</span><span class="token punctuation">.</span><span class="token function">descriptorForRequiredKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">38</span></div><br><div class="line-0-0-19 " data-content="                let store = CNContactStore()"><span class="lineCounter-0-0-18">39</span>                <span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">CNContactStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">40</span></div><br><div class="line-0-0-19 " data-content="                let editContact = try store.unifiedContact(withIdentifier: self.contact.identifier, keysToFetch: [descriptor])"><span class="lineCounter-0-0-18">41</span>                <span class="token keyword">let</span> editContact <span class="token operator">=</span> <span class="token keyword">try</span> store<span class="token punctuation">.</span><span class="token function">unifiedContact</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contact<span class="token punctuation">.</span>identifier<span class="token punctuation">,</span> keysToFetch<span class="token punctuation">:</span> <span class="token punctuation">[</span>descriptor<span class="token punctuation">]</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">42</span></div><br><div class="line-0-0-19 " data-content="                let vc = CNContactViewController(for: editContact) // --> if there's a contact we can edit, we disply the system's view for editing contacts"><span class="lineCounter-0-0-18">43</span>                <span class="token keyword">let</span> vc <span class="token operator">=</span> <span class="token function">CNContactViewController</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> editContact<span class="token punctuation">)</span> <span class="token comment">// --&gt; if there's a contact we can edit, we disply the system's view for editing contacts</span></div><br><div class="line-0-0-19 " data-content="                vc.delegate = context.coordinator"><span class="lineCounter-0-0-18">44</span>                vc<span class="token punctuation">.</span>delegate <span class="token operator">=</span> context<span class="token punctuation">.</span>coordinator</div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">45</span></div><br><div class="line-0-0-19 " data-content="                return vc"><span class="lineCounter-0-0-18">46</span>                <span class="token keyword">return</span> vc</div><br><div class="line-0-0-19 " data-content="            } catch {"><span class="lineCounter-0-0-18">47</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                print(&quot;could not find contact, this happens when we are trying to create a new contact that doesn't exist yet&quot;)"><span class="lineCounter-0-0-18">48</span>                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"could not find contact, this happens when we are trying to create a new contact that doesn't exist yet"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                print(error)"><span class="lineCounter-0-0-18">49</span>                <span class="token function">print</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18 prim">50</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">51</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">52</span></div><br><div class="line-0-0-19 " data-content="        let vc = CNContactViewController(forNewContact: CNContact()) // --> otherwise, we can assume that we want to create a new contact, so we display a fresh view"><span class="lineCounter-0-0-18">53</span>        <span class="token keyword">let</span> vc <span class="token operator">=</span> <span class="token function">CNContactViewController</span><span class="token punctuation">(</span>forNewContact<span class="token punctuation">:</span> <span class="token function">CNContact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; otherwise, we can assume that we want to create a new contact, so we display a fresh view</span></div><br><div class="line-0-0-19 " data-content="        vc.delegate = context.coordinator"><span class="lineCounter-0-0-18">54</span>        vc<span class="token punctuation">.</span>delegate <span class="token operator">=</span> context<span class="token punctuation">.</span>coordinator</div><br><div class="line-0-0-19 " data-content="        return vc"><span class="lineCounter-0-0-18 prim">55</span>        <span class="token keyword">return</span> vc</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">56</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">57</span></div><br><div class="line-0-0-19 " data-content="    func updateUIViewController(_ uiViewController: EditContactView.UIViewControllerType, context: UIViewControllerRepresentableContext<EditContactView>) {"><span class="lineCounter-0-0-18">58</span>    <span class="token keyword">func</span> <span class="token function">updateUIViewController</span><span class="token punctuation">(</span><span class="token number">_</span> uiViewController<span class="token punctuation">:</span> <span class="token builtin">EditContactView</span><span class="token punctuation">.</span><span class="token builtin">UIViewControllerType</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerRepresentableContext</span><span class="token operator">&lt;</span><span class="token builtin">EditContactView</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">59</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18 prim">60</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">61</span><span class="token punctuation">}</span></div><br></code></pre><p>With that, we are pulling in the contact editing view you already know from the phone app.</p><p>Also, that's already it for creating a new contact! SwiftUI really helps us to keep our code tidy.</p><h2 id="6-contact-details-view" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>6. Contact details view</h2><p>We're almost done! Now, we want to display some details for the contacts we've fetched.
For this, we create <code>ContactDetailView</code>, as you've seen in <code>ContactList</code>.</p><p>Like with <code>ContactList</code>, let's first look at <code>ContactDetailViewModel</code>!</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactDetailViewModel.swift</span></span><div class="line-0-0-19 " data-content="import Foundation"><span class="lineCounter-0-0-18 prim">1</span><span class="token keyword">import</span> <span class="token builtin">Foundation</span></div><br><div class="line-0-0-19 " data-content="import Contacts"><span class="lineCounter-0-0-18">2</span><span class="token keyword">import</span> <span class="token builtin">Contacts</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">3</span></div><br><div class="line-0-0-19 " data-content="class ContactDetailViewModel: ObservableObject, Identifiable {"><span class="lineCounter-0-0-18">4</span><span class="token keyword">class</span> <span class="token class-name">ContactDetailViewModel</span><span class="token punctuation">:</span> <span class="token builtin">ObservableObject</span><span class="token punctuation">,</span> <span class="token builtin">Identifiable</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    @Published var contact: Contact"><span class="lineCounter-0-0-18 prim">5</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> contact<span class="token punctuation">:</span> <span class="token builtin">Contact</span></div><br><div class="line-0-0-19 " data-content="    @Published var showEditContactView = false"><span class="lineCounter-0-0-18">6</span>    @<span class="token builtin">Published</span> <span class="token keyword">var</span> showEditContactView <span class="token operator">=</span> <span class="token boolean">false</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">7</span></div><br><div class="line-0-0-19 " data-content="    init(contact: Contact) {"><span class="lineCounter-0-0-18">8</span>    <span class="token keyword">init</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token builtin">Contact</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self.contact = contact"><span class="lineCounter-0-0-18">9</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>contact <span class="token operator">=</span> contact</div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18 prim">10</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">11</span></div><br><div class="line-0-0-19 " data-content="    func updateContact() { // --> When the user is done editing a contact, we inform our view to update the contact to show the newly edited content, so we fetch the updated version"><span class="lineCounter-0-0-18">12</span>    <span class="token keyword">func</span> <span class="token function">updateContact</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; When the user is done editing a contact, we inform our view to update the contact to show the newly edited content, so we fetch the updated version</span></div><br><div class="line-0-0-19 " data-content="        let contactStore = CNContactStore.init()"><span class="lineCounter-0-0-18">13</span>        <span class="token keyword">let</span> contactStore <span class="token operator">=</span> <span class="token builtin">CNContactStore</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        let keysToFetch = [CNContactGivenNameKey, CNContactFamilyNameKey, CNContactPhoneNumbersKey] as [CNKeyDescriptor]"><span class="lineCounter-0-0-18">14</span>        <span class="token keyword">let</span> keysToFetch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">CNContactGivenNameKey</span><span class="token punctuation">,</span> <span class="token builtin">CNContactFamilyNameKey</span><span class="token punctuation">,</span> <span class="token builtin">CNContactPhoneNumbersKey</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token punctuation">[</span><span class="token builtin">CNKeyDescriptor</span><span class="token punctuation">]</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">15</span></div><br><div class="line-0-0-19 " data-content="        do {"><span class="lineCounter-0-0-18">16</span>        <span class="token keyword">do</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            let updated = try contactStore.unifiedContact(withIdentifier: self.contact.systemContact!.identifier, keysToFetch: keysToFetch)"><span class="lineCounter-0-0-18">17</span>            <span class="token keyword">let</span> updated <span class="token operator">=</span> <span class="token keyword">try</span> contactStore<span class="token punctuation">.</span><span class="token function">unifiedContact</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contact<span class="token punctuation">.</span>systemContact<span class="token operator">!</span><span class="token punctuation">.</span>identifier<span class="token punctuation">,</span> keysToFetch<span class="token punctuation">:</span> keysToFetch<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            self.contact = Contact.fromCNContact(contact: updated)"><span class="lineCounter-0-0-18">18</span>            <span class="token keyword">self</span><span class="token punctuation">.</span>contact <span class="token operator">=</span> <span class="token builtin">Contact</span><span class="token punctuation">.</span><span class="token function">fromCNContact</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> updated<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        } catch {"><span class="lineCounter-0-0-18">19</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="            print(error)"><span class="lineCounter-0-0-18 prim">20</span>            <span class="token function">print</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">21</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">22</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">23</span><span class="token punctuation">}</span></div><br></code></pre><p>It's time for the view! You've probably got the grip now on how it should go...</p><pre class="with-bar"><code class="swift code-0-0-17" tabindex="0"><span class="wmbar-0-0-20"><span></span><span></span><span></span><span>ContactDetailView.swift</span></span><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">1</span></div><br><div class="line-0-0-19 " data-content="import SwiftUI"><span class="lineCounter-0-0-18">2</span><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">3</span></div><br><div class="line-0-0-19 " data-content="struct ContactDetailView: View {"><span class="lineCounter-0-0-18">4</span><span class="token keyword">struct</span> <span class="token builtin">ContactDetailView</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="    @ObservedObject var viewModel: ContactDetailViewModel"><span class="lineCounter-0-0-18 prim">5</span>    @<span class="token builtin">ObservedObject</span> <span class="token keyword">var</span> viewModel<span class="token punctuation">:</span> <span class="token builtin">ContactDetailViewModel</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">6</span></div><br><div class="line-0-0-19 " data-content="    init(contact: Contact) {"><span class="lineCounter-0-0-18">7</span>    <span class="token keyword">init</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token builtin">Contact</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        self.viewModel = ContactDetailViewModel(contact: contact)"><span class="lineCounter-0-0-18">8</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel <span class="token operator">=</span> <span class="token function">ContactDetailViewModel</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> contact<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">9</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">10</span></div><br><div class="line-0-0-19 " data-content="    var body: some View {"><span class="lineCounter-0-0-18">11</span>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="        Form() { // --> Form gives us a neat style to replicate the style we already know from the standard contacts app"><span class="lineCounter-0-0-18">12</span>        <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// --&gt; Form gives us a neat style to replicate the style we already know from the standard contacts app</span></div><br><div class="line-0-0-19 " data-content="            HStack() {"><span class="lineCounter-0-0-18">13</span>            <span class="token function">HStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                Text(viewModel.contact.givenName)"><span class="lineCounter-0-0-18">14</span>                <span class="token function">Text</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>givenName<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                Text(viewModel.contact.lastName)"><span class="lineCounter-0-0-18 prim">15</span>                <span class="token function">Text</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">16</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="            .padding(.vertical)"><span class="lineCounter-0-0-18">17</span>            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>vertical<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            .font(.system(.title))"><span class="lineCounter-0-0-18">18</span>            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18">19</span></div><br><div class="line-0-0-19 " data-content=""><span class="lineCounter-0-0-18 prim">20</span></div><br><div class="line-0-0-19 " data-content="            Section() {"><span class="lineCounter-0-0-18">21</span>            <span class="token function">Section</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                ForEach(viewModel.contact.numbers, id: \.number) { number in // --> here, we display all the numbers we got"><span class="lineCounter-0-0-18">22</span>                <span class="token function">ForEach</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>numbers<span class="token punctuation">,</span> id<span class="token punctuation">:</span> \<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token punctuation">{</span> number <span class="token keyword">in</span> <span class="token comment">// --&gt; here, we display all the numbers we got</span></div><br><div class="line-0-0-19 " data-content="                    Button(action: { /* do something */ ); self.modalToggle = false  }) {"><span class="lineCounter-0-0-18">23</span>                    <span class="token function">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">/* do something */</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>modalToggle <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                        VStack(alignment: .leading, spacing: 5) {"><span class="lineCounter-0-0-18">24</span>                        <span class="token function">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                            Text(number.label)"><span class="lineCounter-0-0-18 prim">25</span>                            <span class="token function">Text</span><span class="token punctuation">(</span>number<span class="token punctuation">.</span>label<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                                .font(.system(.subheadline))"><span class="lineCounter-0-0-18">26</span>                                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">.</span>subheadline<span class="token punctuation">)</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                                .foregroundColor(.secondary)"><span class="lineCounter-0-0-18">27</span>                                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>secondary<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                            Text(number.number)"><span class="lineCounter-0-0-18">28</span>                            <span class="token function">Text</span><span class="token punctuation">(</span>number<span class="token punctuation">.</span>number<span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="                        }"><span class="lineCounter-0-0-18">29</span>                        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="                    }"><span class="lineCounter-0-0-18 prim">30</span>                    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="                }"><span class="lineCounter-0-0-18">31</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">32</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="        }"><span class="lineCounter-0-0-18">33</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="        .navigationBarItems(trailing:"><span class="lineCounter-0-0-18">34</span>        <span class="token punctuation">.</span><span class="token function">navigationBarItems</span><span class="token punctuation">(</span>trailing<span class="token punctuation">:</span></div><br><div class="line-0-0-19 " data-content="            Button(action: { self.viewModel.showEditContactView = true }) {"><span class="lineCounter-0-0-18 prim">35</span>            <span class="token function">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span>showEditContactView <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                Text(&quot;Edit&quot;)"><span class="lineCounter-0-0-18">36</span>                <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Edit"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">37</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="            .disabled(self.viewModel.contact.systemContact == nil) // --> we don't want to let the user edit a non-system contact (like the aforementioned cloud-contacts, for example)"><span class="lineCounter-0-0-18">38</span>            <span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>systemContact <span class="token operator">==</span> <span class="token constant">nil</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; we don't want to let the user edit a non-system contact (like the aforementioned cloud-contacts, for example)</span></div><br><div class="line-0-0-19 " data-content="            .sheet(isPresented: self.$viewModel.showEditContactView) {"><span class="lineCounter-0-0-18">39</span>            <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>$viewModel<span class="token punctuation">.</span>showEditContactView<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                NavigationView() {"><span class="lineCounter-0-0-18 prim">40</span>                <span class="token function">NavigationView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                    EditContactView(contact: .constant(self.viewModel.contact.systemContact!)) // --> here, we pass the system contact we set in the beginning!"><span class="lineCounter-0-0-18">41</span>                    <span class="token function">EditContactView</span><span class="token punctuation">(</span>contact<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>systemContact<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; here, we pass the system contact we set in the beginning!</span></div><br><div class="line-0-0-19 " data-content="                }"><span class="lineCounter-0-0-18">42</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="                .onDisappear() {"><span class="lineCounter-0-0-18">43</span>                <span class="token punctuation">.</span><span class="token function">onDisappear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-19 " data-content="                    self.viewModel.updateContact() // --> notify our view model to update the displayed contact"><span class="lineCounter-0-0-18">44</span>                    <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span><span class="token function">updateContact</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// --&gt; notify our view model to update the displayed contact</span></div><br><div class="line-0-0-19 " data-content="                }"><span class="lineCounter-0-0-18 prim">45</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="            }"><span class="lineCounter-0-0-18">46</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="        )"><span class="lineCounter-0-0-18">47</span>        <span class="token punctuation">)</span></div><br><div class="line-0-0-19 " data-content="    }"><span class="lineCounter-0-0-18">48</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-19 " data-content="}"><span class="lineCounter-0-0-18 prim">49</span><span class="token punctuation">}</span></div><br></code></pre><p>As before, we almost get all the heavy-lifting for free thanks to the vast capabilities UIKit already provides without the hassle thanks to SwiftUI!</p><h2 id="7-summary" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>7. Summary</h2><p>What? Already done?</p><p>Yes, we've built all the stuff needed for a fully working <a href="#42-view">contact list</a>, <a href="#51-editcontactview-some-more-uikit-interfacing">editing capabilities</a> and a <a href="#6-contact-details-view">detail view</a> that you can pull into your app! Even if you have different use cases, it's not too much effort to adapt, as we did all the groundwork needed!</p><h2 id="8-building-forward" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>8. Building forward...</h2><p>There's some stuff left we could pull into to make our contact list even more useful.</p><p>Some of those improvements include:</p><ul><li>Showing the profile image the user has set in the list and detail view</li><li>Displaying more details like a contact's location (another way to interface with UIKit)</li><li>Providing more ways to filter the list</li><li>Grouping contacts by their name</li></ul><p>Let's see, I may come back with some posts on how to do those things 😉</p><p><strong>Happy hacking!</strong></p><p>Got any thoughts, improvements or comments? Feel free to reach out to me on <a href="mailto:hey@timweiss.net?subject=Contact%20List%20in%20SwiftUI">hey@timweiss.net</a>! I'd love to hear what you think of this post!</p><hr><div class="contentnav-0-0-10" data-no-search=""><a href="#1-why-this-exists" class="h2" data-content-highlight="1-why-this-exists">1. Why this exists</a><a href="#2-structure-of-the-app" class="h2" data-content-highlight="2-structure-of-the-app">2. Structure of the app</a><a href="#3-fetching-contacts" class="h2" data-content-highlight="3-fetching-contacts">3. Fetching contacts</a><a href="#31-requesting-permissions" class="h3" data-content-highlight="31-requesting-permissions">3.1. Requesting permissions</a><a href="#32-fetching-all-contacts" class="h3" data-content-highlight="32-fetching-all-contacts">3.2. Fetching all contacts</a><a href="#33-the-contact-model" class="h3" data-content-highlight="33-the-contact-model">3.3. The Contact model</a><a href="#4-main-view" class="h2" data-content-highlight="4-main-view">4. Main view</a><a href="#41-view-model" class="h3" data-content-highlight="41-view-model">4.1. View model</a><a href="#42-view" class="h3" data-content-highlight="42-view">4.2. View</a><a href="#43-contactitem-basic-list-item" class="h3" data-content-highlight="43-contactitem-basic-list-item">4.3. ContactItem: Basic list item</a><a href="#44-searchbar-interfacing-with-uikit" class="h3" data-content-highlight="44-searchbar-interfacing-with-uikit">4.4. SearchBar: Interfacing with UIKit</a><a href="#5-creating-a-new-contact" class="h2" data-content-highlight="5-creating-a-new-contact">5. Creating a new contact</a><a href="#51-editcontactview-some-more-uikit-interfacing" class="h3" data-content-highlight="51-editcontactview-some-more-uikit-interfacing">5.1. EditContactView: Some more UIKit interfacing!</a><a href="#6-contact-details-view" class="h2" data-content-highlight="6-contact-details-view">6. Contact details view</a><a href="#7-summary" class="h2" data-content-highlight="7-summary">7. Summary</a><a href="#8-building-forward" class="h2" data-content-highlight="8-building-forward">8. Building forward...</a></div></div><div id="-codedoc-toc" class="toc-0-0-7"><div class="content-0-0-8"><p><a href="/blog/">Home</a></p><div class="collapse-0-0-3 "><script id="kRDVwHYqRi">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("kRDVwHYqRi", "r+Jv/VS/YauITdU0M0jN1Q==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">Swift Stuff</span><span class="icon-font closed">chevron_right</span></div><div class="content"><p><a href="/blog/swift-stuff/building-a-fully-working-contact-list-in-swiftui">Building a fully working contact list in SwiftUI</a>
<a href="/blog/swift-stuff/making-an-image-navigationbarbutton-actually-usable">Making an Image navigationBarButton actually usable</a></p></div></div></div></div><div class="footer-0-0-6"><div class="left"><script id="_ugbmqGMpM">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("_ugbmqGMpM", "krgrG9oFN9VQUm9kMirw5Q==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="qdgqxtkBQa">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("qdgqxtkBQa", "rt07Ne+r5k791oQZALhn6g==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="jXbMAAUbPD">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("jXbMAAUbPD", "5C7mlfiypfDBeBwm8QT42g==", {"namespace":"/blog"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>